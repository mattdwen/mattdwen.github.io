<!DOCTYPE html><html><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><title>Database benchmarking</title><meta name=viewport content="width=device-width"><link href=//fonts.googleapis.com/ rel=dns-prefetch><link href="http://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic,700,700italic" rel=stylesheet type=text/css><link rel=stylesheet href=/css/main.e360.css><link rel=icon href=/favicon.png></head><body><button data-action=open-drawer id=drawer-button class=drawer-button><i class="fa fa-bars"></i></button><nav class=drawer tabindex=-1><div class=drawer-container><ul class=drawer-list role=navigation><li class=drawer-list-item><a href=/ ><i class="fa fa-home"></i>Home</a></li><li class=drawer-list-item><a href=http://www.group6.co.nz target=_blank><i class="fa fa-arrow-circle-o-right"></i>Group 6 Technologies</a></li><li class=drawer-list-item><a href=http://www.winerack.io target=_blank><i class="fa fa-arrow-circle-o-right"></i>winerack.io</a></li><li class=drawer-list-divider></li><li class="drawer-list-item drawer-list-title">Follow me</li><li class=drawer-list-item><a href=http://twitter.com/mattdwen target=_blank><i class="fa fa-twitter"></i>Twitter</a></li><li class=drawer-list-item><a href=http://www.flickr.com/mattdwen target=_blank><i class="fa fa-flickr"></i>Flickr</a></li><li class=drawer-list-item><a href=https://github.com/mattdwen target=_blank><i class="fa fa-github"></i>GitHub</a></li><li class=drawer-list-item><a href=http://instagram.com/mattdwen target=_blank><i class="fa fa-instagram"></i>Instagram</a></li><li class=drawer-list-item><a href=http://mattdwen.tumblr.com/ target=_blank><i class="fa fa-tumblr"></i>Tumblr</a></li></ul></div></nav><div class=drawer-overlay></div><main class=container id=container role=main><div class=surface><div class=surface-container><div class=content><aside class=cover role=banner><div class=cover-image data-load-image=/img/banner.c75b.jpg></div><div class=cover-container><a class=cover-logo href=/ ><img src=/img/avatar.0b80.jpg alt="Matt Dwen"></a><h1 class=cover-title>dwen.co.nz</h1><p class=cover-description>Sorter of Shit</p></div></aside><section class=wrapper tabindex=0><div class=wrapper-container><h2>Database benchmarking</h2><p class=meta>04 Mar 2013</p><div class=post><p>I have performance issues. And it’s nothing a little blue pill is going to solve.</p><p>I’ve had to disable functionality in a project I’ve been working on recently, because the execution time was waaaay to slow for a website. It’s a PHP-MySQL project, and I was expecting it to be slow, but not that bad; I’m talking minutes to render a filter system.</p><p>After some benchmarking of PHP, I turned to checking out the DB performance. I started executing specific queries directly against the DB. When one of the queries took 25 seconds to execute, I took a hunch and ran the same query against the same data in Microsoft SQL Express 2008 R2. Woah.</p><p>The data isn’t complex. Three tables joined, one of products at about 1,600 rows, and some property metadata with about 6,100 distinct property values, and 15,700 relationships between the products and the properties.</p><p>Here’s the query:</p><div class=highlighter-rouge><pre class=highlight><code>SELECT DISTINCT
  prop.id AS propId,
  prop.value,
  pTax.name as taxonomy,
 (SELECT COUNT(property_relationship.id) FROM property_relationship WHERE propertyId = propId) AS productCount
FROM property AS prop
  INNER JOIN property_taxonomy AS pTax ON prop.taxonomyId = pTax.id
  INNER JOIN property_relationship AS pRel ON prop.id = pRel.propertyId
WHERE pTax.isSearchable = 1
  AND pTax.taxonomy = 'product_property'
</code></pre></div><p>So, a bit of a join, a sub-select to get a count, and I want distinct results. 19 Rows returned. Turns out MySQL just plain sucks.</p><p><img src=/img/2013/mar/DBBechmark.c86e.png alt=""></p><p>That’s execution time in seconds. All numbers are an average of 3 executions after a My MySQL server is running straight on my MacbookPro i7 8GB. The SQL2008 and Postgre are both running on a Windows 8 VM on the same hardware, with half the CPU and RAM available.</p><p>Both the DB installs on the VM were clean, with no optimisation, and I used a very half ass tool to get the data between platforms.</p><p>For the record, the MSSQL execution time was 0.15s.</p><p>I am at a total loss to explain this.</p></div><footer class=footer role=contentinfo><p><small>&copy; 2016 Matt Dwen. All Rights Reserved.</small></p></footer></div></section></div></div></div></main><script src=/js/scripts.4f8c.js></script></body></html>